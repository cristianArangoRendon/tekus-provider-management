<div class="page-container">
  <mat-toolbar class="app-toolbar">
    <div class="toolbar-content">
      <div class="left-section">
        <button mat-icon-button class="back-btn" (click)="cancel()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="breadcrumb">
          <span class="parent">Servicios</span>
          <mat-icon class="separator">chevron_right</mat-icon>
          <span class="current">{{ isEditMode ? 'Editar' : 'Nuevo' }}</span>
        </div>
      </div>
    </div>
  </mat-toolbar>

  <div class="content-wrapper">
    <div class="custom-card form-card">
      <div class="card-header">
        <div class="header-icon">
          <mat-icon>{{ isEditMode ? 'edit' : 'add_circle_outline' }}</mat-icon>
        </div>
        <div class="header-text">
          <h1>{{ isEditMode ? 'Editar Servicio' : 'Registrar Servicio' }}</h1>
          <p>Define los detalles y tarifas del servicio.</p>
        </div>
      </div>

      <form [formGroup]="serviceForm" (ngSubmit)="onSubmit()">
        <div class="card-body">
          <div class="form-section">
            <h3>Datos del Servicio</h3>
            
            <div class="input-grid">
              <div class="field-wrapper">
                <mat-label class="custom-label">Nombre del Servicio</mat-label>
                <mat-form-field appearance="outline" class="custom-field">
                  <input 
                    matInput 
                    formControlName="serviceName" 
                    placeholder="Ej. Consultoría Técnica">
                  <mat-icon matPrefix>miscellaneous_services</mat-icon>
                  @if (serviceForm.get('serviceName')?.hasError('required')) {
                    <mat-error>El nombre es requerido</mat-error>
                  }
                </mat-form-field>
              </div>

              <div class="field-wrapper">
                <mat-label class="custom-label">Tarifa por Hora (USD)</mat-label>
                <mat-form-field appearance="outline" class="custom-field">
                  <input 
                    matInput 
                    type="number" 
                    formControlName="hourlyRateUSD" 
                    placeholder="0.00"
                    min="0"
                    step="0.01">
                  <mat-icon matPrefix>attach_money</mat-icon>
                  @if (serviceForm.get('hourlyRateUSD')?.hasError('required')) {
                    <mat-error>La tarifa es requerida</mat-error>
                  }
                  @if (serviceForm.get('hourlyRateUSD')?.hasError('min')) {
                    <mat-error>El valor debe ser positivo</mat-error>
                  }
                </mat-form-field>
              </div>

              <div class="field-wrapper full-width">
                <mat-label class="custom-label">Descripción</mat-label>
                <mat-form-field appearance="outline" class="custom-field">
                  <textarea 
                    matInput 
                    formControlName="description"
                    placeholder="Describe el alcance del servicio..."
                    rows="4"
                    maxlength="500"></textarea>
                  <mat-hint align="end">
                    {{ serviceForm.get('description')?.value?.length || 0 }}/500
                  </mat-hint>
                </mat-form-field>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="info-alert">
            <div class="alert-icon">
              <mat-icon>public</mat-icon>
            </div>
            <div class="alert-content">
              <h4>Disponibilidad Geográfica</h4>
              <p>
                La asignación de países se realiza en el módulo de <strong>Asignaciones</strong> una vez creado el servicio.
              </p>
            </div>
          </div>
        </div>

        <div class="card-footer">
          <button type="button" class="cancel-btn" (click)="cancel()">
            Cancelar
          </button>
          <button type="submit" class="submit-btn" [disabled]="serviceForm.invalid || loading">
            @if (loading) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Procesando...</span>
            } @else {
              <span>{{ isEditMode ? 'Guardar Cambios' : 'Crear Servicio' }}</span>
              <mat-icon>check</mat-icon>
            }
          </button>
        </div>
      </form>
    </div>
  </div>

  @if (loading) {
    <div class="loading-overlay"></div>
  }
</div>